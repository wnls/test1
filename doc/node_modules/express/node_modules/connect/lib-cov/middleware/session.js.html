<!DOCTYPE html>
<html>
<head>
  <title>session.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "node_modules/express/node_modules/connect/lib-cov/middleware/session.js", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>session.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/* automatically generated by JSCoverage - do not edit */</span>
<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_$jscoverage</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">_$jscoverage</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">])</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">37</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">38</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">39</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">40</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">46</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">188</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">189</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">198</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">199</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">203</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">204</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">205</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">206</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">209</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">212</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">218</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">221</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">225</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">228</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">231</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">235</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">238</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">241</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">243</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">244</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">248</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">249</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">250</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">257</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">260</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">261</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">263</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">264</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">267</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">268</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">269</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">270</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">274</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">275</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">276</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">277</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">278</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">279</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">280</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">281</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">282</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">287</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">288</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">292</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">295</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">296</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">297</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">298</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">299</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">303</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">304</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">305</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">307</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">308</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">309</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">310</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">314</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">315</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">316</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">317</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">318</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">320</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">323</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">324</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">325</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">326</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">329</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">330</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">331</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">332</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">333</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">337</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">348</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">349</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">350</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">13</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">Session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./session/session&quot;</span><span class="p">),</span> <span class="nx">debug</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)(</span><span class="s2">&quot;connect:session&quot;</span><span class="p">),</span> <span class="nx">MemoryStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./session/memory&quot;</span><span class="p">),</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;cookie-signature&quot;</span><span class="p">),</span> <span class="nx">Cookie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./session/cookie&quot;</span><span class="p">),</span> <span class="nx">Store</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./session/store&quot;</span><span class="p">),</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./../utils&quot;</span><span class="p">),</span> <span class="nx">parse</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseUrl</span><span class="p">,</span> <span class="nx">crc16</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;crc&quot;</span><span class="p">).</span><span class="nx">crc16</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">25</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">env</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">31</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">37</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">Store</span> <span class="o">=</span> <span class="nx">Store</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">38</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">Cookie</span> <span class="o">=</span> <span class="nx">Cookie</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">39</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">Session</span> <span class="o">=</span> <span class="nx">Session</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">40</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">MemoryStore</span> <span class="o">=</span> <span class="nx">MemoryStore</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">46</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">warning</span> <span class="o">=</span> <span class="s2">&quot;Warning: connection.session() MemoryStore is not\ndesigned for a production environment, as it will leak\nmemory, and will not scale past a single process.&quot;</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">188</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">session</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">189</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">key</span> <span class="o">||</span> <span class="s2">&quot;connect.sid&quot;</span><span class="p">,</span> <span class="nx">store</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">store</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">MemoryStore</span><span class="p">(),</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">trustProxy</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">proxy</span><span class="p">,</span> <span class="nx">storeReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">198</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;production&quot;</span> <span class="o">==</span> <span class="nx">env</span> <span class="o">&amp;&amp;</span> <span class="nx">store</span> <span class="k">instanceof</span> <span class="nx">MemoryStore</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">199</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">warning</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">203</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">generate</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">204</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">uid</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">205</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Session</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">206</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cookie</span><span class="p">(</span><span class="nx">cookie</span><span class="p">);</span>
<span class="p">});</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">209</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;disconnect&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">209</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">storeReady</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">storeReady</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">212</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">session</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">218</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">storeReady</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">218</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;store is disconnected&quot;</span><span class="p">),</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">221</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">originalUrl</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">path</span> <span class="o">||</span> <span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">221</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">225</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">secret</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">secret</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">228</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">228</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;`secret` option required for sessions&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">231</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">originalHash</span><span class="p">,</span> <span class="nx">originalId</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">235</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">sessionStore</span> <span class="o">=</span> <span class="nx">store</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">238</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">rawCookie</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">cookies</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">241</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">unsignedCookie</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">signedCookies</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">243</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">unsignedCookie</span> <span class="o">&amp;&amp;</span> <span class="nx">rawCookie</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">244</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">unsignedCookie</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseSignedCookie</span><span class="p">(</span><span class="nx">rawCookie</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">248</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">249</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">249</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">250</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">cookie</span><span class="p">,</span> <span class="nx">proto</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;x-forwarded-proto&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="nx">tls</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">encrypted</span> <span class="o">||</span> <span class="p">(</span><span class="nx">trustProxy</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;https&quot;</span> <span class="o">==</span> <span class="nx">proto</span><span class="p">),</span> <span class="nx">secured</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">secure</span> <span class="o">&amp;&amp;</span> <span class="nx">tls</span><span class="p">,</span> <span class="nx">isNew</span> <span class="o">=</span> <span class="nx">unsignedCookie</span> <span class="o">!=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">257</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">secure</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">secured</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">257</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;not secured&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">260</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">expires</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">261</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">isNew</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">261</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;already set browser-session cookie&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">263</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">originalHash</span> <span class="o">==</span> <span class="nx">hash</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">originalId</span> <span class="o">==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">264</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;unmodified session&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">267</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="s2">&quot;s:&quot;</span> <span class="o">+</span> <span class="nx">signature</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">,</span> <span class="nx">secret</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">268</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">val</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">269</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;set-cookie %s&quot;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">270</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Set-Cookie&quot;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
<span class="p">}));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">274</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">275</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">276</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="nx">end</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">277</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">277</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">278</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;saving&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">279</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resetMaxAge</span><span class="p">();</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">280</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">save</span><span class="p">((</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">281</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;saved&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">282</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">);</span>
<span class="p">}));</span>
<span class="p">});</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">287</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">generate</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">288</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">store</span><span class="p">.</span><span class="nx">generate</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
<span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">292</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span> <span class="o">=</span> <span class="nx">unsignedCookie</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">295</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">296</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;no SID sent, generating session&quot;</span><span class="p">);</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">297</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">generate</span><span class="p">();</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">298</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">299</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">303</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">pause</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">pause</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">304</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;fetching %s&quot;</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">305</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sess</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">307</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">_next</span> <span class="o">=</span> <span class="nx">next</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">308</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">next</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">309</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">_next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">310</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">pause</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
<span class="p">});</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">314</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">315</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">316</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;ENOENT&quot;</span> <span class="o">==</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">317</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">generate</span><span class="p">();</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">318</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">320</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">323</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">sess</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">324</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;no session found&quot;</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">325</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">generate</span><span class="p">();</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">326</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">329</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;session found&quot;</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">330</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">store</span><span class="p">.</span><span class="nx">createSession</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">sess</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">331</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">originalId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">sessionID</span><span class="p">;</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">332</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">originalHash</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">(</span><span class="nx">sess</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">333</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}));</span>
<span class="p">});</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">337</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">348</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">hash</span><span class="p">(</span><span class="nx">sess</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">349</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">crc16</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">sess</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">350</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;cookie&quot;</span> <span class="o">!=</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">][</span><span class="mi">350</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})));</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/session.js&#39;</span><span class="p">].</span><span class="nx">source</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/*!&quot;</span><span class="p">,</span><span class="s2">&quot; * Connect - session&quot;</span><span class="p">,</span><span class="s2">&quot; * Copyright(c) 2010 Sencha Inc.&quot;</span><span class="p">,</span><span class="s2">&quot; * Copyright(c) 2011 TJ Holowaychuk&quot;</span><span class="p">,</span><span class="s2">&quot; * MIT Licensed&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Module dependencies.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var Session = require(&#39;./session/session&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , debug = require(&#39;debug&#39;)(&#39;connect:session&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , MemoryStore = require(&#39;./session/memory&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , signature = require(&#39;cookie-signature&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , Cookie = require(&#39;./session/cookie&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , Store = require(&#39;./session/store&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , utils = require(&#39;./../utils&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , parse = utils.parseUrl&quot;</span><span class="p">,</span><span class="s2">&quot;  , crc16 = require(&#39;crc&#39;).crc16;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;// environment&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var env = process.env.NODE_ENV;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Expose the middleware.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports = module.exports = session;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Expose constructors.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.Store = Store;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.Cookie = Cookie;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.Session = Session;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.MemoryStore = MemoryStore;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Warning message for `MemoryStore` usage in production.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var warning = &#39;Warning: connection.session() MemoryStore is not\\n&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  + &#39;designed for a production environment, as it will leak\\n&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  + &#39;memory, and will not scale past a single process.&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Session:&quot;</span><span class="p">,</span><span class="s2">&quot; * &quot;</span><span class="p">,</span><span class="s2">&quot; *   Setup session store with the given `options`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *   Session data is _not_ saved in the cookie itself, however&quot;</span><span class="p">,</span><span class="s2">&quot; *   cookies are used, so we must use the [cookieParser()](cookieParser.html)&quot;</span><span class="p">,</span><span class="s2">&quot; *   middleware _before_ `session()`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Examples:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *     connect()&quot;</span><span class="p">,</span><span class="s2">&quot; *       .use(connect.cookieParser())&quot;</span><span class="p">,</span><span class="s2">&quot; *       .use(connect.session({ secret: &#39;keyboard cat&#39;, key: &#39;sid&#39;, cookie: { secure: true }}))&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Options:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `key` cookie name defaulting to `connect.sid`&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `store` session store instance&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `secret` session cookie is signed with this secret to prevent tampering&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `cookie` session cookie settings, defaulting to `{ path: &#39;/&#39;, httpOnly: true, maxAge: null }`&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `proxy` trust the reverse proxy when setting secure cookies (via \&quot;x-forwarded-proto\&quot;)&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Cookie option:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  By default `cookie.maxAge` is `null`, meaning no \&quot;expires\&quot; parameter is set&quot;</span><span class="p">,</span><span class="s2">&quot; *  so the cookie becomes a browser-session cookie. When the user closes the &quot;</span><span class="p">,</span><span class="s2">&quot; *  browser the cookie (and session) will be removed.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## req.session&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  To store or access session data, simply use the request property `req.session`,&quot;</span><span class="p">,</span><span class="s2">&quot; *  which is (generally) serialized as JSON by the store, so nested objects &quot;</span><span class="p">,</span><span class="s2">&quot; *  are typically fine. For example below is a user-specific view counter:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *       connect()&quot;</span><span class="p">,</span><span class="s2">&quot; *         .use(connect.favicon())&quot;</span><span class="p">,</span><span class="s2">&quot; *         .use(connect.cookieParser())&quot;</span><span class="p">,</span><span class="s2">&quot; *         .use(connect.session({ secret: &#39;keyboard cat&#39;, cookie: { maxAge: 60000 }}))&quot;</span><span class="p">,</span><span class="s2">&quot; *         .use(function(req, res, next){&quot;</span><span class="p">,</span><span class="s2">&quot; *           var sess = req.session;&quot;</span><span class="p">,</span><span class="s2">&quot; *           if (sess.views) {&quot;</span><span class="p">,</span><span class="s2">&quot; *             res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot; *             res.write(&#39;&amp;lt;p&amp;gt;views: &#39; + sess.views + &#39;&amp;lt;/p&amp;gt;&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot; *             res.write(&#39;&amp;lt;p&amp;gt;expires in: &#39; + (sess.cookie.maxAge / 1000) + &#39;s&amp;lt;/p&amp;gt;&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot; *             res.end();&quot;</span><span class="p">,</span><span class="s2">&quot; *             sess.views++;&quot;</span><span class="p">,</span><span class="s2">&quot; *           } else {&quot;</span><span class="p">,</span><span class="s2">&quot; *             sess.views = 1;&quot;</span><span class="p">,</span><span class="s2">&quot; *             res.end(&#39;welcome to the session demo. refresh!&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot; *           }&quot;</span><span class="p">,</span><span class="s2">&quot; *         }&quot;</span><span class="p">,</span><span class="s2">&quot; *       )).listen(3000);&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#regenerate()&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  To regenerate the session simply invoke the method, once complete&quot;</span><span class="p">,</span><span class="s2">&quot; *  a new SID and `Session` instance will be initialized at `req.session`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *      req.session.regenerate(function(err){&quot;</span><span class="p">,</span><span class="s2">&quot; *        // will have a new session here&quot;</span><span class="p">,</span><span class="s2">&quot; *      });&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#destroy()&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  Destroys the session, removing `req.session`, will be re-generated next request.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *      req.session.destroy(function(err){&quot;</span><span class="p">,</span><span class="s2">&quot; *        // cannot access session here&quot;</span><span class="p">,</span><span class="s2">&quot; *      });&quot;</span><span class="p">,</span><span class="s2">&quot; * &quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#reload()&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  Reloads the session data.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *      req.session.reload(function(err){&quot;</span><span class="p">,</span><span class="s2">&quot; *        // session updated&quot;</span><span class="p">,</span><span class="s2">&quot; *      });&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#save()&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  Save the session.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *      req.session.save(function(err){&quot;</span><span class="p">,</span><span class="s2">&quot; *        // session saved&quot;</span><span class="p">,</span><span class="s2">&quot; *      });&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#touch()&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *   Updates the `.maxAge` property. Typically this is&quot;</span><span class="p">,</span><span class="s2">&quot; *   not necessary to call, as the session middleware does this for you.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#cookie&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  Each session has a unique cookie object accompany it. This allows&quot;</span><span class="p">,</span><span class="s2">&quot; *  you to alter the session cookie per visitor. For example we can&quot;</span><span class="p">,</span><span class="s2">&quot; *  set `req.session.cookie.expires` to `false` to enable the cookie&quot;</span><span class="p">,</span><span class="s2">&quot; *  to remain for only the duration of the user-agent.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * ## Session#maxAge&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  Alternatively `req.session.cookie.maxAge` will return the time&quot;</span><span class="p">,</span><span class="s2">&quot; *  remaining in milliseconds, which we may also re-assign a new value&quot;</span><span class="p">,</span><span class="s2">&quot; *  to adjust the `.expires` property appropriately. The following&quot;</span><span class="p">,</span><span class="s2">&quot; *  are essentially equivalent&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *     var hour = 3600000;&quot;</span><span class="p">,</span><span class="s2">&quot; *     req.session.cookie.expires = new Date(Date.now() + hour);&quot;</span><span class="p">,</span><span class="s2">&quot; *     req.session.cookie.maxAge = hour;&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * For example when `maxAge` is set to `60000` (one minute), and 30 seconds&quot;</span><span class="p">,</span><span class="s2">&quot; * has elapsed it will return `30000` until the current request has completed,&quot;</span><span class="p">,</span><span class="s2">&quot; * at which time `req.session.touch()` is called to reset `req.session.maxAge`&quot;</span><span class="p">,</span><span class="s2">&quot; * to its original value.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *     req.session.cookie.maxAge;&quot;</span><span class="p">,</span><span class="s2">&quot; *     // =&amp;gt; 30000&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Session Store Implementation:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Every session store _must_ implement the following methods&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *    - `.get(sid, callback)`&quot;</span><span class="p">,</span><span class="s2">&quot; *    - `.set(sid, session, callback)`&quot;</span><span class="p">,</span><span class="s2">&quot; *    - `.destroy(sid, callback)`&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Recommended methods include, but are not limited to:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *    - `.length(callback)`&quot;</span><span class="p">,</span><span class="s2">&quot; *    - `.clear(callback)`&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * For an example implementation view the [connect-redis](http://github.com/visionmedia/connect-redis) repo.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} options&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {Function}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api public&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function session(options){&quot;</span><span class="p">,</span><span class="s2">&quot;  var options = options || {}&quot;</span><span class="p">,</span><span class="s2">&quot;    , key = options.key || &#39;connect.sid&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;    , store = options.store || new MemoryStore&quot;</span><span class="p">,</span><span class="s2">&quot;    , cookie = options.cookie || {}&quot;</span><span class="p">,</span><span class="s2">&quot;    , trustProxy = options.proxy&quot;</span><span class="p">,</span><span class="s2">&quot;    , storeReady = true;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  // notify user that this store is not&quot;</span><span class="p">,</span><span class="s2">&quot;  // meant for a production environment&quot;</span><span class="p">,</span><span class="s2">&quot;  if (&#39;production&#39; == env &amp;amp;&amp;amp; store instanceof MemoryStore) {&quot;</span><span class="p">,</span><span class="s2">&quot;    console.warn(warning);&quot;</span><span class="p">,</span><span class="s2">&quot;  }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  // generates the new session&quot;</span><span class="p">,</span><span class="s2">&quot;  store.generate = function(req){&quot;</span><span class="p">,</span><span class="s2">&quot;    req.sessionID = utils.uid(24);&quot;</span><span class="p">,</span><span class="s2">&quot;    req.session = new Session(req);&quot;</span><span class="p">,</span><span class="s2">&quot;    req.session.cookie = new Cookie(cookie);&quot;</span><span class="p">,</span><span class="s2">&quot;  };&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  store.on(&#39;disconnect&#39;, function(){ storeReady = false; });&quot;</span><span class="p">,</span><span class="s2">&quot;  store.on(&#39;connect&#39;, function(){ storeReady = true; });&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  return function session(req, res, next) {&quot;</span><span class="p">,</span><span class="s2">&quot;    // self-awareness&quot;</span><span class="p">,</span><span class="s2">&quot;    if (req.session) return next();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // Handle connection as if there is no session if&quot;</span><span class="p">,</span><span class="s2">&quot;    // the store has temporarily disconnected etc&quot;</span><span class="p">,</span><span class="s2">&quot;    if (!storeReady) return debug(&#39;store is disconnected&#39;), next();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // pathname mismatch&quot;</span><span class="p">,</span><span class="s2">&quot;    if (0 != req.originalUrl.indexOf(cookie.path || &#39;/&#39;)) return next();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // backwards compatibility for signed cookies&quot;</span><span class="p">,</span><span class="s2">&quot;    // req.secret is passed from the cookie parser middleware&quot;</span><span class="p">,</span><span class="s2">&quot;    var secret = options.secret || req.secret;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // ensure secret is available or bail&quot;</span><span class="p">,</span><span class="s2">&quot;    if (!secret) throw new Error(&#39;`secret` option required for sessions&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // parse url&quot;</span><span class="p">,</span><span class="s2">&quot;    var originalHash&quot;</span><span class="p">,</span><span class="s2">&quot;      , originalId;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // expose store&quot;</span><span class="p">,</span><span class="s2">&quot;    req.sessionStore = store;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // grab the session cookie value and check the signature&quot;</span><span class="p">,</span><span class="s2">&quot;    var rawCookie = req.cookies[key];&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // get signedCookies for backwards compat with signed cookies&quot;</span><span class="p">,</span><span class="s2">&quot;    var unsignedCookie = req.signedCookies[key];&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    if (!unsignedCookie &amp;amp;&amp;amp; rawCookie) {&quot;</span><span class="p">,</span><span class="s2">&quot;      unsignedCookie = utils.parseSignedCookie(rawCookie, secret);&quot;</span><span class="p">,</span><span class="s2">&quot;    }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // set-cookie&quot;</span><span class="p">,</span><span class="s2">&quot;    res.on(&#39;header&#39;, function(){&quot;</span><span class="p">,</span><span class="s2">&quot;      if (!req.session) return;&quot;</span><span class="p">,</span><span class="s2">&quot;      var cookie = req.session.cookie&quot;</span><span class="p">,</span><span class="s2">&quot;        , proto = (req.headers[&#39;x-forwarded-proto&#39;] || &#39;&#39;).toLowerCase()&quot;</span><span class="p">,</span><span class="s2">&quot;        , tls = req.connection.encrypted || (trustProxy &amp;amp;&amp;amp; &#39;https&#39; == proto)&quot;</span><span class="p">,</span><span class="s2">&quot;        , secured = cookie.secure &amp;amp;&amp;amp; tls&quot;</span><span class="p">,</span><span class="s2">&quot;        , isNew = unsignedCookie != req.sessionID;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // only send secure cookies via https&quot;</span><span class="p">,</span><span class="s2">&quot;      if (cookie.secure &amp;amp;&amp;amp; !secured) return debug(&#39;not secured&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // browser-session length cookie&quot;</span><span class="p">,</span><span class="s2">&quot;      if (null == cookie.expires) {&quot;</span><span class="p">,</span><span class="s2">&quot;        if (!isNew) return debug(&#39;already set browser-session cookie&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      // compare hashes and ids&quot;</span><span class="p">,</span><span class="s2">&quot;      } else if (originalHash == hash(req.session) &amp;amp;&amp;amp; originalId == req.session.id) {&quot;</span><span class="p">,</span><span class="s2">&quot;        return debug(&#39;unmodified session&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      var val = &#39;s:&#39; + signature.sign(req.sessionID, secret);&quot;</span><span class="p">,</span><span class="s2">&quot;      val = cookie.serialize(key, val);&quot;</span><span class="p">,</span><span class="s2">&quot;      debug(&#39;set-cookie %s&#39;, val);&quot;</span><span class="p">,</span><span class="s2">&quot;      res.setHeader(&#39;Set-Cookie&#39;, val);&quot;</span><span class="p">,</span><span class="s2">&quot;    });&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // proxy end() to commit the session&quot;</span><span class="p">,</span><span class="s2">&quot;    var end = res.end;&quot;</span><span class="p">,</span><span class="s2">&quot;    res.end = function(data, encoding){&quot;</span><span class="p">,</span><span class="s2">&quot;      res.end = end;&quot;</span><span class="p">,</span><span class="s2">&quot;      if (!req.session) return res.end(data, encoding);&quot;</span><span class="p">,</span><span class="s2">&quot;      debug(&#39;saving&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      req.session.resetMaxAge();&quot;</span><span class="p">,</span><span class="s2">&quot;      req.session.save(function(){&quot;</span><span class="p">,</span><span class="s2">&quot;        debug(&#39;saved&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        res.end(data, encoding);&quot;</span><span class="p">,</span><span class="s2">&quot;      });&quot;</span><span class="p">,</span><span class="s2">&quot;    };&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // generate the session&quot;</span><span class="p">,</span><span class="s2">&quot;    function generate() {&quot;</span><span class="p">,</span><span class="s2">&quot;      store.generate(req);&quot;</span><span class="p">,</span><span class="s2">&quot;    }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // get the sessionID from the cookie&quot;</span><span class="p">,</span><span class="s2">&quot;    req.sessionID = unsignedCookie;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // generate a session if the browser doesn&#39;t send a sessionID&quot;</span><span class="p">,</span><span class="s2">&quot;    if (!req.sessionID) {&quot;</span><span class="p">,</span><span class="s2">&quot;      debug(&#39;no SID sent, generating session&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      generate();&quot;</span><span class="p">,</span><span class="s2">&quot;      next();&quot;</span><span class="p">,</span><span class="s2">&quot;      return;&quot;</span><span class="p">,</span><span class="s2">&quot;    }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // generate the session object&quot;</span><span class="p">,</span><span class="s2">&quot;    var pause = utils.pause(req);&quot;</span><span class="p">,</span><span class="s2">&quot;    debug(&#39;fetching %s&#39;, req.sessionID);&quot;</span><span class="p">,</span><span class="s2">&quot;    store.get(req.sessionID, function(err, sess){&quot;</span><span class="p">,</span><span class="s2">&quot;      // proxy to resume() events&quot;</span><span class="p">,</span><span class="s2">&quot;      var _next = next;&quot;</span><span class="p">,</span><span class="s2">&quot;      next = function(err){&quot;</span><span class="p">,</span><span class="s2">&quot;        _next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;        pause.resume();&quot;</span><span class="p">,</span><span class="s2">&quot;      };&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // error handling&quot;</span><span class="p">,</span><span class="s2">&quot;      if (err) {&quot;</span><span class="p">,</span><span class="s2">&quot;        debug(&#39;error&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        if (&#39;ENOENT&#39; == err.code) {&quot;</span><span class="p">,</span><span class="s2">&quot;          generate();&quot;</span><span class="p">,</span><span class="s2">&quot;          next();&quot;</span><span class="p">,</span><span class="s2">&quot;        } else {&quot;</span><span class="p">,</span><span class="s2">&quot;          next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;        }&quot;</span><span class="p">,</span><span class="s2">&quot;      // no session&quot;</span><span class="p">,</span><span class="s2">&quot;      } else if (!sess) {&quot;</span><span class="p">,</span><span class="s2">&quot;        debug(&#39;no session found&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        generate();&quot;</span><span class="p">,</span><span class="s2">&quot;        next();&quot;</span><span class="p">,</span><span class="s2">&quot;      // populate req.session&quot;</span><span class="p">,</span><span class="s2">&quot;      } else {&quot;</span><span class="p">,</span><span class="s2">&quot;        debug(&#39;session found&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        store.createSession(req, sess);&quot;</span><span class="p">,</span><span class="s2">&quot;        originalId = req.sessionID;&quot;</span><span class="p">,</span><span class="s2">&quot;        originalHash = hash(sess);&quot;</span><span class="p">,</span><span class="s2">&quot;        next();&quot;</span><span class="p">,</span><span class="s2">&quot;      }&quot;</span><span class="p">,</span><span class="s2">&quot;    });&quot;</span><span class="p">,</span><span class="s2">&quot;  };&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Hash the given `sess` object omitting changes&quot;</span><span class="p">,</span><span class="s2">&quot; * to `.cookie`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} sess&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {String}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function hash(sess) {&quot;</span><span class="p">,</span><span class="s2">&quot;  return crc16(JSON.stringify(sess, function(key, val){&quot;</span><span class="p">,</span><span class="s2">&quot;    if (&#39;cookie&#39; != key) return val;&quot;</span><span class="p">,</span><span class="s2">&quot;  }));&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">];</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
