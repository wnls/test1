<!DOCTYPE html>
<html>
<head>
  <title>directory.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "node_modules/express/node_modules/connect/lib-cov/middleware/directory.js", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>directory.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/* automatically generated by JSCoverage - do not edit */</span>
<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_$jscoverage</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">_$jscoverage</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">])</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">29</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">48</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">49</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">52</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">53</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">58</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">59</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">61</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">70</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">73</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">76</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">77</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">84</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">85</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">86</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">87</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">88</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">91</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">92</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">93</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">94</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">109</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">110</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">111</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">112</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">113</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">114</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">115</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">120</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">121</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">122</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">131</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">132</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">133</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">134</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">135</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">142</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">143</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">144</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">145</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">146</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">153</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">154</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">155</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">156</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">157</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">165</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">166</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">167</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">170</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">171</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">172</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">173</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">176</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">194</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">195</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">196</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">208</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">209</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">218</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">17</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">),</span> <span class="nx">parse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">).</span><span class="nx">parse</span><span class="p">,</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../utils&quot;</span><span class="p">),</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">),</span> <span class="nx">normalize</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">normalize</span><span class="p">,</span> <span class="nx">extname</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">,</span> <span class="nx">join</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">;</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">29</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">48</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">directory</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">49</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">52</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">52</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;directory() root path required&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">53</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">hidden</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hidden</span><span class="p">,</span> <span class="nx">icons</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">icons</span><span class="p">,</span> <span class="nx">filter</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">normalize</span><span class="p">(</span><span class="nx">root</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">58</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">directory</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">59</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;GET&quot;</span> <span class="o">!=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;HEAD&quot;</span> <span class="o">!=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">59</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">61</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">accept</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">accept</span> <span class="o">||</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">),</span> <span class="nx">dir</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">pathname</span><span class="p">),</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">normalize</span><span class="p">(</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)),</span> <span class="nx">originalUrl</span> <span class="o">=</span> <span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">originalUrl</span><span class="p">),</span> <span class="nx">originalDir</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">originalUrl</span><span class="p">.</span><span class="nx">pathname</span><span class="p">),</span> <span class="nx">showUp</span> <span class="o">=</span> <span class="nx">path</span> <span class="o">!=</span> <span class="nx">root</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span> <span class="o">!=</span> <span class="nx">root</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">70</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">~</span> <span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;\u0000&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">70</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="mi">400</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">73</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">73</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="mi">403</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">76</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">77</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">77</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="s2">&quot;ENOENT&quot;</span> <span class="o">==</span> <span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="o">?</span> <span class="nx">next</span><span class="p">()</span><span class="o">:</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">84</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">85</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">85</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">86</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">hidden</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">86</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">files</span> <span class="o">=</span> <span class="nx">removeHidden</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">87</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">87</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">filter</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">88</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">files</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">91</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">92</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span> <span class="nx">accept</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="o">||</span> <span class="o">~</span> <span class="nx">accept</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;*/*&quot;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">93</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">exports</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">files</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">originalDir</span><span class="p">,</span> <span class="nx">showUp</span><span class="p">,</span> <span class="nx">icons</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">94</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">99</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="mi">406</span><span class="p">));</span>
<span class="p">}));</span>
<span class="p">}));</span>
<span class="p">});</span>
<span class="p">});</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">109</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">files</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">showUp</span><span class="p">,</span> <span class="nx">icons</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">110</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../public/directory.html&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">111</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">111</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">112</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../public/style.css&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">style</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">113</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">113</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">114</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">showUp</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">114</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">files</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">115</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;{style}&quot;</span><span class="p">,</span> <span class="nx">style</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;{files}&quot;</span><span class="p">,</span> <span class="nx">html</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">icons</span><span class="p">)).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;{directory}&quot;</span><span class="p">,</span> <span class="nx">dir</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;{linked-path}&quot;</span><span class="p">,</span> <span class="nx">htmlPath</span><span class="p">(</span><span class="nx">dir</span><span class="p">));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">120</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/html&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">121</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">122</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
<span class="p">}));</span>
<span class="p">}));</span>
<span class="p">});</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">131</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">json</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">132</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">files</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">133</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">134</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">135</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">142</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">plain</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">143</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">files</span> <span class="o">=</span> <span class="nx">files</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">144</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">145</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">,</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">146</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">files</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">153</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">htmlPath</span><span class="p">(</span><span class="nx">dir</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">154</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">curr</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">155</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">dir</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="kd">function</span> <span class="p">(</span><span class="nx">part</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">156</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">curr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">part</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">157</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;a href=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">curr</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">part</span> <span class="o">+</span> <span class="s2">&quot;&lt;/a&gt;&quot;</span><span class="p">;</span>
<span class="p">})).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; / &quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">165</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">html</span><span class="p">(</span><span class="nx">files</span><span class="p">,</span> <span class="nx">dir</span><span class="p">,</span> <span class="nx">useIcons</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">166</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;ul id=\&quot;files\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">files</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">167</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">170</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">useIcons</span> <span class="o">&amp;&amp;</span> <span class="s2">&quot;..&quot;</span> <span class="o">!=</span> <span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">171</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">icon</span> <span class="o">=</span> <span class="nx">icons</span><span class="p">[</span><span class="nx">extname</span><span class="p">(</span><span class="nx">file</span><span class="p">)]</span> <span class="o">||</span> <span class="nx">icons</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">];</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">172</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">icon</span> <span class="o">=</span> <span class="s2">&quot;&lt;img src=\&quot;data:image/png;base64,&quot;</span> <span class="o">+</span> <span class="nx">load</span><span class="p">(</span><span class="nx">icon</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot; /&gt;&quot;</span><span class="p">;</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">173</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">classes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">176</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="s2">&quot;&lt;li&gt;&lt;a href=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot; class=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&quot;</span> <span class="o">+</span> <span class="s2">&quot; title=\&quot;&quot;</span> <span class="o">+</span> <span class="nx">file</span> <span class="o">+</span> <span class="s2">&quot;\&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">icon</span> <span class="o">+</span> <span class="nx">file</span> <span class="o">+</span> <span class="s2">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="p">;</span>
<span class="p">})).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;/ul&gt;&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">194</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">load</span><span class="p">(</span><span class="nx">icon</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">195</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">icon</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">195</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">icon</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">196</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">icon</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../public/icons/&quot;</span> <span class="o">+</span> <span class="nx">icon</span><span class="p">,</span> <span class="s2">&quot;base64&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">208</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">removeHidden</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">209</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">files</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="s2">&quot;.&quot;</span> <span class="o">!=</span> <span class="nx">file</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}));</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">][</span><span class="mi">218</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">icons</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;.js&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_code_red.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.c&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_c.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.h&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_h.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.cc&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_cplusplus.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.php&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_php.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.rb&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_ruby.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.cpp&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_cplusplus.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.swf&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_flash.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white_acrobat.png&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="o">:</span> <span class="s2">&quot;page_white.png&quot;</span><span class="p">};</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/directory.js&#39;</span><span class="p">].</span><span class="nx">source</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/*!&quot;</span><span class="p">,</span><span class="s2">&quot; * Connect - directory&quot;</span><span class="p">,</span><span class="s2">&quot; * Copyright(c) 2011 Sencha Inc.&quot;</span><span class="p">,</span><span class="s2">&quot; * Copyright(c) 2011 TJ Holowaychuk&quot;</span><span class="p">,</span><span class="s2">&quot; * MIT Licensed&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;// TODO: icon / style for directories&quot;</span><span class="p">,</span><span class="s2">&quot;// TODO: arrow key navigation&quot;</span><span class="p">,</span><span class="s2">&quot;// TODO: make icons extensible&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Module dependencies.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var fs = require(&#39;fs&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , parse = require(&#39;url&#39;).parse&quot;</span><span class="p">,</span><span class="s2">&quot;  , utils = require(&#39;../utils&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , path = require(&#39;path&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , normalize = path.normalize&quot;</span><span class="p">,</span><span class="s2">&quot;  , extname = path.extname&quot;</span><span class="p">,</span><span class="s2">&quot;  , join = path.join;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/*!&quot;</span><span class="p">,</span><span class="s2">&quot; * Icon cache.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var cache = {};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Directory:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Serve directory listings with the given `root` path.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Options:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *  - `hidden` display hidden (dot) files. Defaults to false.&quot;</span><span class="p">,</span><span class="s2">&quot; *  - `icons`  display icons. Defaults to false.&quot;</span><span class="p">,</span><span class="s2">&quot; *  - `filter` Apply this filter function to files. Defaults to false.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {String} root&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} options&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {Function}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api public&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports = module.exports = function directory(root, options){&quot;</span><span class="p">,</span><span class="s2">&quot;  options = options || {};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  // root required&quot;</span><span class="p">,</span><span class="s2">&quot;  if (!root) throw new Error(&#39;directory() root path required&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;  var hidden = options.hidden&quot;</span><span class="p">,</span><span class="s2">&quot;    , icons = options.icons&quot;</span><span class="p">,</span><span class="s2">&quot;    , filter = options.filter&quot;</span><span class="p">,</span><span class="s2">&quot;    , root = normalize(root);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  return function directory(req, res, next) {&quot;</span><span class="p">,</span><span class="s2">&quot;    if (&#39;GET&#39; != req.method &amp;amp;&amp;amp; &#39;HEAD&#39; != req.method) return next();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    var accept = req.headers.accept || &#39;text/plain&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      , url = parse(req.url)&quot;</span><span class="p">,</span><span class="s2">&quot;      , dir = decodeURIComponent(url.pathname)&quot;</span><span class="p">,</span><span class="s2">&quot;      , path = normalize(join(root, dir))&quot;</span><span class="p">,</span><span class="s2">&quot;      , originalUrl = parse(req.originalUrl)&quot;</span><span class="p">,</span><span class="s2">&quot;      , originalDir = decodeURIComponent(originalUrl.pathname)&quot;</span><span class="p">,</span><span class="s2">&quot;      , showUp = path != root &amp;amp;&amp;amp; path != root + &#39;/&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // null byte(s), bad request&quot;</span><span class="p">,</span><span class="s2">&quot;    if (~path.indexOf(&#39;\\0&#39;)) return next(utils.error(400));&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // malicious path, forbidden&quot;</span><span class="p">,</span><span class="s2">&quot;    if (0 != path.indexOf(root)) return next(utils.error(403));&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // check if we have a directory&quot;</span><span class="p">,</span><span class="s2">&quot;    fs.stat(path, function(err, stat){&quot;</span><span class="p">,</span><span class="s2">&quot;      if (err) return &#39;ENOENT&#39; == err.code&quot;</span><span class="p">,</span><span class="s2">&quot;        ? next()&quot;</span><span class="p">,</span><span class="s2">&quot;        : next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      if (!stat.isDirectory()) return next();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // fetch files&quot;</span><span class="p">,</span><span class="s2">&quot;      fs.readdir(path, function(err, files){&quot;</span><span class="p">,</span><span class="s2">&quot;        if (err) return next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;        if (!hidden) files = removeHidden(files);&quot;</span><span class="p">,</span><span class="s2">&quot;        if (filter) files = files.filter(filter);&quot;</span><span class="p">,</span><span class="s2">&quot;        files.sort();&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;        // content-negotiation&quot;</span><span class="p">,</span><span class="s2">&quot;        for (var key in exports) {&quot;</span><span class="p">,</span><span class="s2">&quot;          if (~accept.indexOf(key) || ~accept.indexOf(&#39;*/*&#39;)) {&quot;</span><span class="p">,</span><span class="s2">&quot;            exports[key](req, res, files, next, originalDir, showUp, icons);&quot;</span><span class="p">,</span><span class="s2">&quot;            return;&quot;</span><span class="p">,</span><span class="s2">&quot;          }&quot;</span><span class="p">,</span><span class="s2">&quot;        }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;        // not acceptable&quot;</span><span class="p">,</span><span class="s2">&quot;        next(utils.error(406));&quot;</span><span class="p">,</span><span class="s2">&quot;      });&quot;</span><span class="p">,</span><span class="s2">&quot;    });&quot;</span><span class="p">,</span><span class="s2">&quot;  };&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Respond with text/html.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.html = function(req, res, files, next, dir, showUp, icons){&quot;</span><span class="p">,</span><span class="s2">&quot;  fs.readFile(__dirname + &#39;/../public/directory.html&#39;, &#39;utf8&#39;, function(err, str){&quot;</span><span class="p">,</span><span class="s2">&quot;    if (err) return next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;    fs.readFile(__dirname + &#39;/../public/style.css&#39;, &#39;utf8&#39;, function(err, style){&quot;</span><span class="p">,</span><span class="s2">&quot;      if (err) return next(err);&quot;</span><span class="p">,</span><span class="s2">&quot;      if (showUp) files.unshift(&#39;..&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      str = str&quot;</span><span class="p">,</span><span class="s2">&quot;        .replace(&#39;{style}&#39;, style)&quot;</span><span class="p">,</span><span class="s2">&quot;        .replace(&#39;{files}&#39;, html(files, dir, icons))&quot;</span><span class="p">,</span><span class="s2">&quot;        .replace(&#39;{directory}&#39;, dir)&quot;</span><span class="p">,</span><span class="s2">&quot;        .replace(&#39;{linked-path}&#39;, htmlPath(dir));&quot;</span><span class="p">,</span><span class="s2">&quot;      res.setHeader(&#39;Content-Type&#39;, &#39;text/html&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      res.setHeader(&#39;Content-Length&#39;, str.length);&quot;</span><span class="p">,</span><span class="s2">&quot;      res.end(str);&quot;</span><span class="p">,</span><span class="s2">&quot;    });&quot;</span><span class="p">,</span><span class="s2">&quot;  });&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Respond with application/json.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.json = function(req, res, files){&quot;</span><span class="p">,</span><span class="s2">&quot;  files = JSON.stringify(files);&quot;</span><span class="p">,</span><span class="s2">&quot;  res.setHeader(&#39;Content-Type&#39;, &#39;application/json&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;  res.setHeader(&#39;Content-Length&#39;, files.length);&quot;</span><span class="p">,</span><span class="s2">&quot;  res.end(files);&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Respond with text/plain.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;exports.plain = function(req, res, files){&quot;</span><span class="p">,</span><span class="s2">&quot;  files = files.join(&#39;\\n&#39;) + &#39;\\n&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;  res.setHeader(&#39;Content-Type&#39;, &#39;text/plain&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;  res.setHeader(&#39;Content-Length&#39;, files.length);&quot;</span><span class="p">,</span><span class="s2">&quot;  res.end(files);&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Map html `dir`, returning a linked path.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function htmlPath(dir) {&quot;</span><span class="p">,</span><span class="s2">&quot;  var curr = [];&quot;</span><span class="p">,</span><span class="s2">&quot;  return dir.split(&#39;/&#39;).map(function(part){&quot;</span><span class="p">,</span><span class="s2">&quot;    curr.push(part);&quot;</span><span class="p">,</span><span class="s2">&quot;    return &#39;&amp;lt;a href=\&quot;&#39; + curr.join(&#39;/&#39;) + &#39;\&quot;&amp;gt;&#39; + part + &#39;&amp;lt;/a&amp;gt;&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;  }).join(&#39; / &#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Map html `files`, returning an html unordered list.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function html(files, dir, useIcons) {&quot;</span><span class="p">,</span><span class="s2">&quot;  return &#39;&amp;lt;ul id=\&quot;files\&quot;&amp;gt;&#39; + files.map(function(file){&quot;</span><span class="p">,</span><span class="s2">&quot;    var icon = &#39;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      , classes = [];&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    if (useIcons &amp;amp;&amp;amp; &#39;..&#39; != file) {&quot;</span><span class="p">,</span><span class="s2">&quot;      icon = icons[extname(file)] || icons.default;&quot;</span><span class="p">,</span><span class="s2">&quot;      icon = &#39;&amp;lt;img src=\&quot;data:image/png;base64,&#39; + load(icon) + &#39;\&quot; /&amp;gt;&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;      classes.push(&#39;icon&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;    }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    return &#39;&amp;lt;li&amp;gt;&amp;lt;a href=\&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      + join(dir, file)&quot;</span><span class="p">,</span><span class="s2">&quot;      + &#39;\&quot; class=\&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      + classes.join(&#39; &#39;) + &#39;\&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      + &#39; title=\&quot;&#39; + file + &#39;\&quot;&amp;gt;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;      + icon + file + &#39;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  }).join(&#39;\\n&#39;) + &#39;&amp;lt;/ul&amp;gt;&#39;;&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Load and cache the given `icon`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {String} icon&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {String}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function load(icon) {&quot;</span><span class="p">,</span><span class="s2">&quot;  if (cache[icon]) return cache[icon];&quot;</span><span class="p">,</span><span class="s2">&quot;  return cache[icon] = fs.readFileSync(__dirname + &#39;/../public/icons/&#39; + icon, &#39;base64&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Filter \&quot;hidden\&quot; `files`, aka files&quot;</span><span class="p">,</span><span class="s2">&quot; * beginning with a `.`.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Array} files&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {Array}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function removeHidden(files) {&quot;</span><span class="p">,</span><span class="s2">&quot;  return files.filter(function(file){&quot;</span><span class="p">,</span><span class="s2">&quot;    return &#39;.&#39; != file[0];&quot;</span><span class="p">,</span><span class="s2">&quot;  });&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Icon map.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var icons = {&quot;</span><span class="p">,</span><span class="s2">&quot;    &#39;.js&#39;: &#39;page_white_code_red.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.c&#39;: &#39;page_white_c.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.h&#39;: &#39;page_white_h.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.cc&#39;: &#39;page_white_cplusplus.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.php&#39;: &#39;page_white_php.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.rb&#39;: &#39;page_white_ruby.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.cpp&#39;: &#39;page_white_cplusplus.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.swf&#39;: &#39;page_white_flash.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;.pdf&#39;: &#39;page_white_acrobat.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;  , &#39;default&#39;: &#39;page_white.png&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">];</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
