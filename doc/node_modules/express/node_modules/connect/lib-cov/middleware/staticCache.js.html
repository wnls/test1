<!DOCTYPE html>
<html>
<head>
  <title>staticCache.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../", thisFile = "node_modules/express/node_modules/connect/lib-cov/middleware/staticCache.js", defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>staticCache.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/* automatically generated by JSCoverage - do not edit */</span>
<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">_$jscoverage</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">_$jscoverage</span> <span class="o">=</span> <span class="p">{};</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">])</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">51</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">52</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">56</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">57</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">59</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">60</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">68</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">69</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">75</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">78</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">84</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">88</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">91</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">94</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">95</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">96</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">97</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">99</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">104</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">107</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">110</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">111</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">115</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">116</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">117</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">118</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">119</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">120</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">124</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">125</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">126</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">127</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">129</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">131</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">132</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">135</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">151</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">152</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">156</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">158</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">160</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">161</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">162</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">164</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">165</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">166</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">167</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">169</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">171</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">172</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">173</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">174</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">175</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">178</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">181</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">183</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">186</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">187</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">200</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">201</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">206</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">208</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">212</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">216</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">229</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">230</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">12</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../utils&quot;</span><span class="p">),</span> <span class="nx">Cache</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../cache&quot;</span><span class="p">),</span> <span class="nx">fresh</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fresh&quot;</span><span class="p">);</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">51</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">staticCache</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">52</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cache</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">maxObjects</span> <span class="o">||</span> <span class="mi">128</span><span class="p">),</span> <span class="nx">maxlen</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span> <span class="o">||</span> <span class="mi">262144</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">56</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;connect.staticCache() is deprecated and will be removed in 3.0&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">57</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s2">&quot;use varnish or similar reverse proxy caches.&quot;</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">59</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kd">function</span> <span class="nx">staticCache</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">60</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">cacheKey</span><span class="p">(</span><span class="nx">req</span><span class="p">),</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">range</span><span class="p">,</span> <span class="nx">hasCookies</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span><span class="p">,</span> <span class="nx">hit</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">68</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">req</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;static&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">69</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">_headers</span><span class="p">,</span> <span class="nx">cc</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseCacheControl</span><span class="p">(</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;cache-control&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">contentLength</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;content-length&quot;</span><span class="p">],</span> <span class="nx">hit</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">75</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;set-cookie&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">75</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">hasCookies</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">78</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hasCookies</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">78</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">contentLength</span> <span class="o">||</span> <span class="nx">contentLength</span> <span class="o">&gt;</span> <span class="nx">maxlen</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">81</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">84</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;content-range&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">84</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">88</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cc</span><span class="p">[</span><span class="s2">&quot;no-cache&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cc</span><span class="p">[</span><span class="s2">&quot;no-store&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cc</span><span class="p">[</span><span class="s2">&quot;private&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cc</span><span class="p">[</span><span class="s2">&quot;must-revalidate&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">91</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">94</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hit</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">95</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">headers</span><span class="p">.</span><span class="nx">etag</span> <span class="o">==</span> <span class="nx">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">etag</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">96</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">hit</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">97</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">99</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">cache</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">104</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="nx">stream</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">104</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">107</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">110</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">111</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">chunk</span><span class="p">);</span>
<span class="p">}));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">115</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">stream</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">116</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">cacheEntry</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">117</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">delete</span> <span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;x-cache&quot;</span><span class="p">];</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">118</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">cacheEntry</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">119</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">cacheEntry</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">headers</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">120</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">cacheEntry</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">cacheEntry</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
<span class="p">}));</span>
<span class="p">}));</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">124</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">125</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ranges</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">126</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">127</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">hasCookies</span> <span class="o">&amp;&amp;</span> <span class="nx">hit</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nx">mustRevalidate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">hit</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">128</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;X-Cache&quot;</span><span class="p">,</span> <span class="s2">&quot;HIT&quot;</span><span class="p">);</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">129</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">respondFromCache</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">hit</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">131</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s2">&quot;X-Cache&quot;</span><span class="p">,</span> <span class="s2">&quot;MISS&quot;</span><span class="p">);</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">132</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">next</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">135</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="p">});</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">151</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">respondFromCache</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">cacheEntry</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">152</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">status</span> <span class="o">=</span> <span class="nx">cacheEntry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">merge</span><span class="p">({},</span> <span class="nx">cacheEntry</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">cacheEntry</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">156</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="nx">headers</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">headers</span><span class="p">.</span><span class="nx">date</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">158</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="s2">&quot;HEAD&quot;</span><span class="o">:</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">160</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="nx">status</span><span class="p">,</span> <span class="nx">headers</span><span class="p">);</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">161</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">162</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="s2">&quot;GET&quot;</span><span class="o">:</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">164</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">conditionalGET</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">fresh</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">,</span> <span class="nx">headers</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">165</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;content-length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">166</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">304</span><span class="p">,</span> <span class="nx">headers</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">167</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">169</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="nx">status</span><span class="p">,</span> <span class="nx">headers</span><span class="p">);</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">171</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="kd">function</span> <span class="nx">write</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">172</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">173</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="kc">false</span> <span class="o">===</span> <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">shift</span><span class="p">()))</span> <span class="p">{</span>
            <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">174</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&quot;drain&quot;</span><span class="p">,</span> <span class="nx">write</span><span class="p">);</span>
            <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">175</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
<span class="p">}</span>
        <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">178</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">}</span>
      <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">181</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
      <span class="nx">write</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">183</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">186</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">187</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">200</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">mustRevalidate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">cacheEntry</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">201</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">cacheHeaders</span> <span class="o">=</span> <span class="nx">cacheEntry</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">reqCC</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseCacheControl</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="s2">&quot;cache-control&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">cacheCC</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseCacheControl</span><span class="p">(</span><span class="nx">cacheHeaders</span><span class="p">[</span><span class="s2">&quot;cache-control&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="nx">cacheAge</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">-</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">cacheHeaders</span><span class="p">.</span><span class="nx">date</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">206</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">cacheCC</span><span class="p">[</span><span class="s2">&quot;no-cache&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cacheCC</span><span class="p">[</span><span class="s2">&quot;must-revalidate&quot;</span><span class="p">]</span> <span class="o">||</span> <span class="nx">cacheCC</span><span class="p">[</span><span class="s2">&quot;proxy-revalidate&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">208</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">reqCC</span><span class="p">[</span><span class="s2">&quot;no-cache&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">210</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">212</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="nx">reqCC</span><span class="p">[</span><span class="s2">&quot;max-age&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">212</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">reqCC</span><span class="p">[</span><span class="s2">&quot;max-age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">cacheAge</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="nx">cacheCC</span><span class="p">[</span><span class="s2">&quot;max-age&quot;</span><span class="p">])</span> <span class="p">{</span>
    <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">214</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">cacheCC</span><span class="p">[</span><span class="s2">&quot;max-age&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">cacheAge</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">216</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">229</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">cacheKey</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">][</span><span class="mi">230</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">parseUrl</span><span class="p">(</span><span class="nx">req</span><span class="p">).</span><span class="nx">path</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">_$jscoverage</span><span class="p">[</span><span class="s1">&#39;middleware/staticCache.js&#39;</span><span class="p">].</span><span class="nx">source</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/*!&quot;</span><span class="p">,</span><span class="s2">&quot; * Connect - staticCache&quot;</span><span class="p">,</span><span class="s2">&quot; * Copyright(c) 2011 Sencha Inc.&quot;</span><span class="p">,</span><span class="s2">&quot; * MIT Licensed&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Module dependencies.&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;var utils = require(&#39;../utils&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , Cache = require(&#39;../cache&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;  , fresh = require(&#39;fresh&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Static cache:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Enables a memory cache layer on top of&quot;</span><span class="p">,</span><span class="s2">&quot; * the `static()` middleware, serving popular&quot;</span><span class="p">,</span><span class="s2">&quot; * static files.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * By default a maximum of 128 objects are&quot;</span><span class="p">,</span><span class="s2">&quot; * held in cache, with a max of 256k each,&quot;</span><span class="p">,</span><span class="s2">&quot; * totalling ~32mb.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * A Least-Recently-Used (LRU) cache algo&quot;</span><span class="p">,</span><span class="s2">&quot; * is implemented through the `Cache` object,&quot;</span><span class="p">,</span><span class="s2">&quot; * simply rotating cache objects as they are&quot;</span><span class="p">,</span><span class="s2">&quot; * hit. This means that increasingly popular&quot;</span><span class="p">,</span><span class="s2">&quot; * objects maintain their positions while&quot;</span><span class="p">,</span><span class="s2">&quot; * others get shoved out of the stack and&quot;</span><span class="p">,</span><span class="s2">&quot; * garbage collected.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Benchmarks:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *     static(): 2700 rps&quot;</span><span class="p">,</span><span class="s2">&quot; *     node-static: 5300 rps&quot;</span><span class="p">,</span><span class="s2">&quot; *     static() + staticCache(): 7500 rps&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * Options:&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `maxObjects`  max cache objects [128]&quot;</span><span class="p">,</span><span class="s2">&quot; *   - `maxLength`  max cache object length 256kb&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} options&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {Function}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api public&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;module.exports = function staticCache(options){&quot;</span><span class="p">,</span><span class="s2">&quot;  var options = options || {}&quot;</span><span class="p">,</span><span class="s2">&quot;    , cache = new Cache(options.maxObjects || 128)&quot;</span><span class="p">,</span><span class="s2">&quot;    , maxlen = options.maxLength || 1024 * 256;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  console.warn(&#39;connect.staticCache() is deprecated and will be removed in 3.0&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;  console.warn(&#39;use varnish or similar reverse proxy caches.&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  return function staticCache(req, res, next){&quot;</span><span class="p">,</span><span class="s2">&quot;    var key = cacheKey(req)&quot;</span><span class="p">,</span><span class="s2">&quot;      , ranges = req.headers.range&quot;</span><span class="p">,</span><span class="s2">&quot;      , hasCookies = req.headers.cookie&quot;</span><span class="p">,</span><span class="s2">&quot;      , hit = cache.get(key);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    // cache static&quot;</span><span class="p">,</span><span class="s2">&quot;    // TODO: change from staticCache() -&amp;gt; cache()&quot;</span><span class="p">,</span><span class="s2">&quot;    // and make this work for any request&quot;</span><span class="p">,</span><span class="s2">&quot;    req.on(&#39;static&#39;, function(stream){&quot;</span><span class="p">,</span><span class="s2">&quot;      var headers = res._headers&quot;</span><span class="p">,</span><span class="s2">&quot;        , cc = utils.parseCacheControl(headers[&#39;cache-control&#39;] || &#39;&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;        , contentLength = headers[&#39;content-length&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;        , hit;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // dont cache set-cookie responses&quot;</span><span class="p">,</span><span class="s2">&quot;      if (headers[&#39;set-cookie&#39;]) return hasCookies = true;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // dont cache when cookies are present&quot;</span><span class="p">,</span><span class="s2">&quot;      if (hasCookies) return;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // ignore larger files&quot;</span><span class="p">,</span><span class="s2">&quot;      if (!contentLength || contentLength &amp;gt; maxlen) return;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // don&#39;t cache partial files&quot;</span><span class="p">,</span><span class="s2">&quot;      if (headers[&#39;content-range&#39;]) return;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // dont cache items we shouldn&#39;t be&quot;</span><span class="p">,</span><span class="s2">&quot;      // TODO: real support for must-revalidate / no-cache&quot;</span><span class="p">,</span><span class="s2">&quot;      if ( cc[&#39;no-cache&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;        || cc[&#39;no-store&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;        || cc[&#39;private&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;        || cc[&#39;must-revalidate&#39;]) return;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // if already in cache then validate&quot;</span><span class="p">,</span><span class="s2">&quot;      if (hit = cache.get(key)){&quot;</span><span class="p">,</span><span class="s2">&quot;        if (headers.etag == hit[0].etag) {&quot;</span><span class="p">,</span><span class="s2">&quot;          hit[0].date = new Date;&quot;</span><span class="p">,</span><span class="s2">&quot;          return;&quot;</span><span class="p">,</span><span class="s2">&quot;        } else {&quot;</span><span class="p">,</span><span class="s2">&quot;          cache.remove(key);&quot;</span><span class="p">,</span><span class="s2">&quot;        }&quot;</span><span class="p">,</span><span class="s2">&quot;      }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // validation notifiactions don&#39;t contain a steam&quot;</span><span class="p">,</span><span class="s2">&quot;      if (null == stream) return;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // add the cache object&quot;</span><span class="p">,</span><span class="s2">&quot;      var arr = [];&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // store the chunks&quot;</span><span class="p">,</span><span class="s2">&quot;      stream.on(&#39;data&#39;, function(chunk){&quot;</span><span class="p">,</span><span class="s2">&quot;        arr.push(chunk);&quot;</span><span class="p">,</span><span class="s2">&quot;      });&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;      // flag it as complete&quot;</span><span class="p">,</span><span class="s2">&quot;      stream.on(&#39;end&#39;, function(){&quot;</span><span class="p">,</span><span class="s2">&quot;        var cacheEntry = cache.add(key);&quot;</span><span class="p">,</span><span class="s2">&quot;        delete headers[&#39;x-cache&#39;]; // Clean up (TODO: others)&quot;</span><span class="p">,</span><span class="s2">&quot;        cacheEntry.push(200);&quot;</span><span class="p">,</span><span class="s2">&quot;        cacheEntry.push(headers);&quot;</span><span class="p">,</span><span class="s2">&quot;        cacheEntry.push.apply(cacheEntry, arr);&quot;</span><span class="p">,</span><span class="s2">&quot;      });&quot;</span><span class="p">,</span><span class="s2">&quot;    });&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;    if (req.method == &#39;GET&#39; || req.method == &#39;HEAD&#39;) {&quot;</span><span class="p">,</span><span class="s2">&quot;      if (ranges) {&quot;</span><span class="p">,</span><span class="s2">&quot;        next();&quot;</span><span class="p">,</span><span class="s2">&quot;      } else if (!hasCookies &amp;amp;&amp;amp; hit &amp;amp;&amp;amp; !mustRevalidate(req, hit)) {&quot;</span><span class="p">,</span><span class="s2">&quot;        res.setHeader(&#39;X-Cache&#39;, &#39;HIT&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        respondFromCache(req, res, hit);&quot;</span><span class="p">,</span><span class="s2">&quot;      } else {&quot;</span><span class="p">,</span><span class="s2">&quot;        res.setHeader(&#39;X-Cache&#39;, &#39;MISS&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;        next();&quot;</span><span class="p">,</span><span class="s2">&quot;      }&quot;</span><span class="p">,</span><span class="s2">&quot;    } else {&quot;</span><span class="p">,</span><span class="s2">&quot;      next();&quot;</span><span class="p">,</span><span class="s2">&quot;    }&quot;</span><span class="p">,</span><span class="s2">&quot;  }&quot;</span><span class="p">,</span><span class="s2">&quot;};&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Respond with the provided cached value.&quot;</span><span class="p">,</span><span class="s2">&quot; * TODO: Assume 200 code, that&#39;s iffy.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} req&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} res&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} cacheEntry&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {String}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function respondFromCache(req, res, cacheEntry) {&quot;</span><span class="p">,</span><span class="s2">&quot;  var status = cacheEntry[0]&quot;</span><span class="p">,</span><span class="s2">&quot;    , headers = utils.merge({}, cacheEntry[1])&quot;</span><span class="p">,</span><span class="s2">&quot;    , content = cacheEntry.slice(2);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  headers.age = (new Date - new Date(headers.date)) / 1000 || 0;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  switch (req.method) {&quot;</span><span class="p">,</span><span class="s2">&quot;    case &#39;HEAD&#39;:&quot;</span><span class="p">,</span><span class="s2">&quot;      res.writeHead(status, headers);&quot;</span><span class="p">,</span><span class="s2">&quot;      res.end();&quot;</span><span class="p">,</span><span class="s2">&quot;      break;&quot;</span><span class="p">,</span><span class="s2">&quot;    case &#39;GET&#39;:&quot;</span><span class="p">,</span><span class="s2">&quot;      if (utils.conditionalGET(req) &amp;amp;&amp;amp; fresh(req.headers, headers)) {&quot;</span><span class="p">,</span><span class="s2">&quot;        headers[&#39;content-length&#39;] = 0;&quot;</span><span class="p">,</span><span class="s2">&quot;        res.writeHead(304, headers);&quot;</span><span class="p">,</span><span class="s2">&quot;        res.end();&quot;</span><span class="p">,</span><span class="s2">&quot;      } else {&quot;</span><span class="p">,</span><span class="s2">&quot;        res.writeHead(status, headers);&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;        function write() {&quot;</span><span class="p">,</span><span class="s2">&quot;          while (content.length) {&quot;</span><span class="p">,</span><span class="s2">&quot;            if (false === res.write(content.shift())) {&quot;</span><span class="p">,</span><span class="s2">&quot;              res.once(&#39;drain&#39;, write);&quot;</span><span class="p">,</span><span class="s2">&quot;              return;&quot;</span><span class="p">,</span><span class="s2">&quot;            }&quot;</span><span class="p">,</span><span class="s2">&quot;          }&quot;</span><span class="p">,</span><span class="s2">&quot;          res.end();&quot;</span><span class="p">,</span><span class="s2">&quot;        }&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;        write();&quot;</span><span class="p">,</span><span class="s2">&quot;      }&quot;</span><span class="p">,</span><span class="s2">&quot;      break;&quot;</span><span class="p">,</span><span class="s2">&quot;    default:&quot;</span><span class="p">,</span><span class="s2">&quot;      // This should never happen.&quot;</span><span class="p">,</span><span class="s2">&quot;      res.writeHead(500, &#39;&#39;);&quot;</span><span class="p">,</span><span class="s2">&quot;      res.end();&quot;</span><span class="p">,</span><span class="s2">&quot;  }&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * Determine whether or not a cached value must be revalidated.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} req&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} cacheEntry&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {String}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function mustRevalidate(req, cacheEntry) {&quot;</span><span class="p">,</span><span class="s2">&quot;  var cacheHeaders = cacheEntry[1]&quot;</span><span class="p">,</span><span class="s2">&quot;    , reqCC = utils.parseCacheControl(req.headers[&#39;cache-control&#39;] || &#39;&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;    , cacheCC = utils.parseCacheControl(cacheHeaders[&#39;cache-control&#39;] || &#39;&#39;)&quot;</span><span class="p">,</span><span class="s2">&quot;    , cacheAge = (new Date - new Date(cacheHeaders.date)) / 1000 || 0;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  if ( cacheCC[&#39;no-cache&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;    || cacheCC[&#39;must-revalidate&#39;]&quot;</span><span class="p">,</span><span class="s2">&quot;    || cacheCC[&#39;proxy-revalidate&#39;]) return true;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  if (reqCC[&#39;no-cache&#39;]) return true;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  if (null != reqCC[&#39;max-age&#39;]) return reqCC[&#39;max-age&#39;] &amp;lt; cacheAge;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  if (null != cacheCC[&#39;max-age&#39;]) return cacheCC[&#39;max-age&#39;] &amp;lt; cacheAge;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;  return false;&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;/**&quot;</span><span class="p">,</span><span class="s2">&quot; * The key to use in the cache. For now, this is the URL path and query.&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * &#39;http://example.com?key=value&#39; -&amp;gt; &#39;/?key=value&#39;&quot;</span><span class="p">,</span><span class="s2">&quot; *&quot;</span><span class="p">,</span><span class="s2">&quot; * @param {Object} req&quot;</span><span class="p">,</span><span class="s2">&quot; * @return {String}&quot;</span><span class="p">,</span><span class="s2">&quot; * @api private&quot;</span><span class="p">,</span><span class="s2">&quot; */&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;function cacheKey(req) {&quot;</span><span class="p">,</span><span class="s2">&quot;  return utils.parseUrl(req).path;&quot;</span><span class="p">,</span><span class="s2">&quot;}&quot;</span><span class="p">];</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
